message(STATUS "-------------- FmuComponentChrono2 --------------")

message(STATUS "\nFetch fmu_tools...")

set(FMU_MODEL_IDENTIFIER "FmuComponentChrono2" CACHE INTERNAL "Set the FMU model identifier (name).")
set(BUILD_FMU_HOST OFF CACHE INTERNAL "Enable fmu_host.")
set(USE_CUSTOM_TYPESPLATFORM OFF CACHE INTERNAL "")
set(FMU_MSG_PREFIX "   ")

FetchContent_Declare(
    ${FMU_MODEL_IDENTIFIER}
    SOURCE_DIR ${CHRONO_FMU_TOOLS_DIR}/fmi2
)

FetchContent_MakeAvailable(${FMU_MODEL_IDENTIFIER})

string(TOUPPER ${FMU_MODEL_IDENTIFIER} FMU_MODEL_IDENTIFIER_UPPERCASE)
MARK_AS_ADVANCED(FETCHCONTENT_BASE_DIR)
MARK_AS_ADVANCED(FETCHCONTENT_FULLY_DISCONNECTED)
MARK_AS_ADVANCED(FETCHCONTENT_QUIET)
MARK_AS_ADVANCED(FETCHCONTENT_SOURCE_DIR_${FMU_MODEL_IDENTIFIER_UPPERCASE})
MARK_AS_ADVANCED(FETCHCONTENT_UPDATES_DISCONNECTED)
MARK_AS_ADVANCED(FETCHCONTENT_UPDATES_DISCONNECTED_${FMU_MODEL_IDENTIFIER_UPPERCASE})

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE ${FMU_RUNTIME_OUTPUT_DIRECTORY})
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG ${FMU_RUNTIME_OUTPUT_DIRECTORY})

# =========
# Build FMU
# =========

message(STATUS "\nConfigure FMU...")

# tell upper level to copy DLLS into the FMU-specific folder
list(APPEND FMU_RUNTIME_OUTPUT_DIRECTORIES ${FMU_RUNTIME_OUTPUT_DIRECTORY})
set(FMU_RUNTIME_OUTPUT_DIRECTORIES ${FMU_RUNTIME_OUTPUT_DIRECTORIES} PARENT_SCOPE)

# Append FMU sources toi automatically generated target
target_sources(${FMU_MODEL_IDENTIFIER} PRIVATE FmuComponentChrono2.h FmuComponentChrono2.cpp)

target_compile_definitions(${FMU_MODEL_IDENTIFIER} PUBLIC "CHRONO_DATA_DIR=\"${CHRONO_DATA_DIR}\"") 
target_compile_options(${FMU_MODEL_IDENTIFIER} PUBLIC ${CHRONO_CXX_FLAGS})
target_link_options(${FMU_MODEL_IDENTIFIER} PUBLIC ${CHRONO_LINKER_FLAGS})
target_link_libraries(${FMU_MODEL_IDENTIFIER} ${CHRONO_LIBRARIES})

add_dependencies(${FMU_MODEL_IDENTIFIER} COPY_DLLS_FMU)
